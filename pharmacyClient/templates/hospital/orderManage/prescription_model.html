<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>中药房处方笺</title>
    {#    <link type="text/css" rel="stylesheet" href="../libs/bootstrap.css">#}
{#    <link type="text/css" rel="stylesheet" href="{% static 'css/mall/bootstrap.min.css' %}">#}
</head>
<body>
<div class="container">
    <div style="width:559.44px;height:793.8px;border:1px solid #000000;">
        <table border rules=none cellspacing=0 style="width:559.44px;">
            {#        <table class="table table-striped table-hover table-bordered">#}
            <thead>
            <tr>
                <th colspan="8" style="text-align: center"><h4 style="font-weight: bolder">{{ company }}处方笺</h4></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td style="color: red"><b>{{ prescription.prescri_id }}</b></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>处方单号:</td>
                <td>{{ prescription.prescri_id }}</td>
                <td>订&nbsp;&nbsp;单&nbsp;&nbsp;号:</td>
                <td>{{ order.order_id }}</td>
                <td>开单日期:</td>
                <td>{{ order.order_time }}</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:</td>
                <td><b>{{ prescription.user_name }}</b></td>
                <td>联系电话:</td>
                <td>{{ prescription.tel }}</td>
                <td>科&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;室:</td>
                {% if prescription.hos_depart %}
                    <td>{{ prescription.hos_depart }}</td>
                {% else %}
                    <td></td>
                {% endif %}
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;龄:</td>
                <td>{{ prescription.age }}</td>
                <td>性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别:</td>
                {% if prescription.gender == 0 %}
                    <td>女</td>
                {% elif prescription.gender == 1 %}
                    <td>男</td>
                {% else %}
                    <td>未知</td>
                {% endif %}
                <td>门诊(住院)号:</td>
                {% if prescription.hospital_num %}
                    <td>{{ prescription.hospital_num }}</td>
                {% else %}
                    <td>{{ prescription.treat_card_id }}</td>
                {% endif %}
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>收货地址:</td>
                <td colspan="7">{{ address }}</td>
            </tr>
            <tr>
                <td>临床诊断:</td>
                {% if prescription.special_instru %}
                    <td colspan="7">{{ prescription.special_instru }}</td>
                {% else %}
                    <td colspan="7"></td>
                {% endif %}
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注:</td>
                {% if prescription.prescript_remark %}
                    <td colspan="7">{{ prescription.prescript_remark }}</td>
                {% else %}
                    <td colspan="7"></td>
                {% endif %}
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
{#        <table border rules=rows cellspacing=0 id="drugs" style="width: 559.44px">#}
        <table border rules=none cellspacing=0 id="drugs" style="width: 559.44px">
            <thead>
            <tr>
                <th colspan="18" style="text-align: left"><h1 style="font-weight: bolder"></h1>Rp.</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>药品</td>
                <td></td>
                <td></td>
                <td>剂量</td>
                <td></td>
                <td></td>
                <td>用法</td>
                <td></td>
                <td></td>
                <td>药品</td>
                <td></td>
                <td></td>
                <td>剂量</td>
                <td></td>
                <td></td>
                <td>用法</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
        <table border rules=none cellspacing=0 style="width:559.44px;">
            <tbody>
            <tr>
                <td>剂&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;数 :</td>
                {% if prescription.is_suffering == 1 %}
                    <td>{{ prescription.amount }} <b>(代煎)</b> 每剂 {{ prescription.per_pack_num }} 袋</td>
                {% else %}
                    <td>{{ prescription.amount }} <b>(饮片)</b></td>
                {% endif %}
                <td></td>
                <td>煎煮数量 :</td>
                {% if prescription.is_suffering == 1 %}
                    <td>{{ prescription.amount }} * {{ prescription.per_pack_num }} 共 {{ prescription.suffering_num }}
                        袋
                    </td>
                {% else %}
                    <td> 0</td>
                {% endif %}
                <td></td>
                <td>调&nbsp;&nbsp;剂&nbsp;&nbsp;员:</td>
                <td>{{ oper_user }}</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>药材费用 :</td>
                <td>{{ prescription.drug_price }}</td>
                <td></td>
                <td>煎煮费用 :</td>
                <td>{{ prescription.suffering_price }}</td>
                <td></td>
                <td>总金额 :</td>
                <td>{{ prescription.pres_price_totle }}</td>
            </tr>
            </tbody>
        </table>
    </div>
    <input type="hidden" name="prescriId" id="prescriId" value="{{ prescription.prescri_id }}"/>
</div>
<script src="{% static 'js/hospital/jquery-1.12.3.min.js' %}"></script>
<script>
    var prescri_id = $("#prescriId").val();
    console.log(prescri_id);
    $.get("{% url 'hospital_client:printPrescription' type='drugs' %}", {prescriId: prescri_id}, function (data) {
        {#console.log(data);#}
        var list = JSON.parse(data);
        console.log(list);
        var dt = document.getElementById('drugs'); {# 药品表格 #}
        {#console.log(dt2);#}
        var rows = dt.rows.length;  {# 药品表格行数 #}
        var cells = dt.rows[1].cells.length;    {# 列数 #}
        var drugsCount = list.length;   {# 药品总数 #}
        console.log(drugsCount);
        console.log(rows);
        console.log(cells);
        console.log(dt.rows[0]);
        console.log(dt.rows[0].cells);
        console.log(dt.rows[0].cells[0]);
        console.log(dt.rows[0].cells[0].innerText);
        console.log(drugsCount%2 == 0);
        if (drugsCount%2 == 0) {
            var n = parseInt(drugsCount/2);
            for (i=2; i <= n+1;i++) {
                for (j = 0; j < cells; j++) {
                    if (j === 0) {
                        dt.rows[i].cells[j].innerText = list[i-2].fields.medicines;
                    } else if (j === 3) {
                        dt.rows[i].cells[j].innerText = list[i-2].fields.dose + list[i-2].fields.unit;
                    } else if (j === 6) {
                        dt.rows[i].cells[j].innerText = list[i-2].fields.m_usage;
                    } else if (j ===9){
                        dt.rows[i].cells[j].innerText = list[i+n-2].fields.medicines;
                    }else if (j === 12) {
                        dt.rows[i].cells[j].innerText = list[i+n-2].fields.dose + list[i+n-2].fields.unit;
                    } else if (j === 15) {
                        dt.rows[i].cells[j].innerText = list[i+n-2].fields.m_usage;
                    } else continue;
                }
            }
        }else {
            var n = parseInt(drugsCount/2);
            for (i=2; i <= n+1;i++) {
                for (j = 0; j < cells; j++) {
                    if (j === 0) {
                        dt.rows[i].cells[j].innerText = list[i-2].fields.medicines;
                    } else if (j === 3) {
                        dt.rows[i].cells[j].innerText = list[i-2].fields.dose + list[i-2].fields.unit;
                    } else if (j === 6) {
                        dt.rows[i].cells[j].innerText = list[i-2].fields.m_usage;
                    } else if (j ===9){
                        dt.rows[i].cells[j].innerText = list[i+n-2].fields.medicines;
                    }else if (j === 12) {
                        dt.rows[i].cells[j].innerText = list[i+n-2].fields.dose + list[i+n-2].fields.unit;
                    } else if (j === 15) {
                        dt.rows[i].cells[j].innerText = list[i+n-2].fields.m_usage;
                    } else continue;
                }
            }
            dt.rows[n+2].cells[0].innerText = list[drugsCount-1].fields.medicines;
            dt.rows[n+2].cells[3].innerText = list[drugsCount-1].fields.dose + list[drugsCount-1].fields.unit;
            dt.rows[n+2].cells[6].innerText = list[drugsCount-1].fields.m_usage;
        }
    });
</script>
</body>
</html>